<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>StockPricePredictions — Shree Yantra Signals</title>
  <meta name="description" content="Vedic-themed stock predictor with live OHLC, autocomplete, and a global indices ticker." />

  <link rel="icon" type="image/png" href="logo.png" />
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="fix.css" />

  <meta name="google-adsense-account" content="ca-pub-6957786074161829" />
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6957786074161829" crossorigin="anonymous"></script>
</head>
<body>
  <!-- Header -->
  <header class="site-header">
    <div class="wrap header-row">
      <div class="brand">
        <img class="logo" src="logo.png" alt="Stock Price Predictions Logo" />
        <div>
          <h1>Shree Yantra <span>Stock Predictor</span></h1>
          <p class="tag">Vedic-inspired signals • Real OHLC • Free</p>
        </div>
      </div>
      <nav class="nav">
        <a href="index.html" aria-current="page">Home</a>
        <a href="about.html" target="_blank" rel="noopener">About</a>
        <a href="privacy.html" target="_blank" rel="noopener">Privacy</a>
        <a href="terms.html" target="_blank" rel="noopener">Terms</a>
        <a href="contact.html" target="_blank" rel="noopener">Contact</a>
      </nav>
    </div>
  </header>

  <!-- Main -->
  <main class="wrap">
    <section class="panel">
      <h2 class="hero-title">Find a stock. See today’s OHLC and a mystical hint for tomorrow.</h2>
      <p class="lede">Type a company or ticker to get live OHLC data and our Sree Yantra based next-day signal.</p>

      <div class="search-stack">
        <div class="row">
          <input id="ticker" placeholder="Type company or ticker (e.g., Tata Motors, RELIANCE.NS, AAPL)" />
          <button id="go" class="btn">Analyze</button>
        </div>
        <div id="suggestBox" class="suggest hidden" role="listbox" aria-label="Suggestions"></div>
      </div>

      <article id="card" class="card hidden" aria-live="polite">
        <header class="card-head">
          <h3 id="cTicker">-</h3>
          <span id="mktYes" class="chip" title="Market open now?">-</span>
          <div id="cSignal" class="chip">Awaiting...</div>
        </header>

        <div class="ohlc">
          <div class="kv"><span>Open</span><strong id="cOpen">-</strong></div>
          <div class="kv"><span>High</span><strong id="cHigh">-</strong></div>
          <div class="kv"><span>Low</span><strong id="cLow">-</strong></div>
          <div class="kv"><span>Close</span><strong id="cClose">-</strong></div>
        </div>

        <!-- Will be rewritten to: "Prediction For Next Day Date: YYYY-MM-DD : ▲ Price Up (1)" -->
        <p class="pred-note" id="predNote">Prediction For Next Day Date: - : ▲ Price Up (1)</p>

        <!-- Market status line -->
        <p class="muted tiny" id="mktDisplay" aria-live="polite">Display Market: -</p>
      </article>
    </section>
  </main>

  <!-- Global indices ticker -->
  <div class="ticker" aria-label="Global market ticker">
    <div class="wrap ticker-viewport">
      <div class="ticker-track" id="tickerTrack"></div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="footer">
    <div class="wrap footer-content">
      <p>© 2025 StockPricePredictions.com • Signals are informational only • <a href="privacy.html" target="_blank" rel="noopener">Privacy</a></p>
      <div class="social-icons">
        <a href="#" target="_blank" rel="noopener" aria-label="Facebook"><img src="icons/facebook.svg" alt="Facebook"></a>
        <a href="#" target="_blank" rel="noopener" aria-label="Twitter"><img src="icons/twitter.svg" alt="Twitter"></a>
        <a href="#" target="_blank" rel="noopener" aria-label="Instagram"><img src="icons/instagram.svg" alt="Instagram"></a>
        <a href="#" target="_blank" rel="noopener" aria-label="LinkedIn"><img src="icons/linkedin.svg" alt="LinkedIn"></a>
        <a href="#" target="_blank" rel="noopener" aria-label="YouTube"><img src="icons/youtube.svg" alt="YouTube"></a>
      </div>
    </div>
  </footer>

  <!-- Your existing app config + code -->
  <script>
    window.API_BASE = "https://api.stockpricepredictions.com";
  </script>
  <script src="script.js"></script>

  <!-- Enhancer: uses Render API to get target date + market open/closed (non-blocking) -->
  <script>
    (function () {
      function ready(fn){
        if (document.readyState === "complete" || document.readyState === "interactive") { setTimeout(fn, 0); }
        else { document.addEventListener("DOMContentLoaded", fn); }
      }

      ready(function(){
        var PRED_BASE   = "https://stockpricepredictions-api.onrender.com";
        var elTicker    = document.getElementById("cTicker");
        var elPredNote  = document.getElementById("predNote");
        var elSignal    = document.getElementById("cSignal");
        var elYes       = document.getElementById("mktYes");
        var elDisplay   = document.getElementById("mktDisplay");
        var input       = document.getElementById("ticker");
        var btn         = document.getElementById("go");

        if (!elPredNote) return;

        function currentSignalText(){
          var raw = (elSignal && elSignal.textContent) ? elSignal.textContent : (elPredNote.textContent || "");
          var i = raw.lastIndexOf(":");
          return (i >= 0 ? raw.slice(i+1) : raw).trim() || "▲";
        }

        function rewritePrediction(targetDate){
          var signal = currentSignalText();
          elPredNote.textContent = "Prediction For Next Day Date: " + (targetDate || "-") + " : " + signal;
        }

        function setMarket(openNow, venue){
          if (elYes) {
            elYes.textContent = openNow ? "Yes" : "No";
            elYes.classList.remove("chip--ok","chip--off");
            elYes.classList.add(openNow ? "chip--ok" : "chip--off");
          }
          if (elDisplay) {
            elDisplay.textContent = "Display Market: " + (openNow ? "Open" : "Closed") + (venue ? " ("+venue+")" : "");
          }
        }

        function symbolFromValue(v) {
          var t = String(v || "").trim();
          var token = t.split(/\s+/).find(function(s){ return /\.\w+$/.test(s); });
          return (token || t).toUpperCase();
        }

        var lastRequested = "";
        function fetchPrediction(sym){
          sym = (sym || "").trim().toUpperCase();
          if (!sym || sym === lastRequested) return;
          lastRequested = sym;

          var url = PRED_BASE.replace(/\/$/, "") + "/predict-next?symbol=" + encodeURIComponent(sym);
          fetch(url, { mode: "cors" })
            .then(function(res){ return res.text().then(function(txt){ return {ok:res.ok, txt:txt}; }); })
            .then(function(r){
              if (!r.ok) throw new Error("HTTP "+r.status+": "+r.txt);
              var data = JSON.parse(r.txt);
              var target = (data && data.prediction && data.prediction.target_date) || "-";
              var openNow = !!(data && data.market_meta && data.market_meta.market_open_now);
              var venue   = (data && data.market_meta && data.market_meta.venue) || "";
              rewritePrediction(target);
              setMarket(openNow, venue);
            })
            .catch(function(err){
              console.warn("[enhancer] fetch failed:", err);
              // never throw
            });
        }

        var tmr = null;
        function triggerDebounced(){
          if (tmr) clearTimeout(tmr);
          tmr = setTimeout(function(){
            var v = (input && input.value) ? input.value : (elTicker && elTicker.textContent) || "";
            if (v) fetchPrediction(symbolFromValue(v));
          }, 220); // small delay so your app finishes its own updates
        }

        // Observe your app's ticker updates (won't block)
        if (elTicker) {
          var last = elTicker.textContent;
          var mo = new MutationObserver(function(){
            var curr = elTicker.textContent && elTicker.textContent.trim();
            if (curr && curr !== last) {
              last = curr;
              triggerDebounced();
            }
          });
          mo.observe(elTicker, { childList: true, characterData: true, subtree: true });
        }

        // Let your own handlers run first (no capture)
        if (btn)   btn.addEventListener("click", function(){ triggerDebounced(); });
        if (input) input.addEventListener("keydown", function(e){ if (e.key === "Enter") triggerDebounced(); });

        // Safety: try once after load (in case your app preloads a symbol)
        setTimeout(triggerDebounced, 450);
      });
    })();
  </script>
</body>
</html>
