<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>StockPricePredictions — Shree Yantra Signals</title>
  <meta name="description" content="Vedic-themed stock predictor with live OHLC, autocomplete, and a global indices ticker." />

  <link rel="icon" type="image/png" href="logo.png" />
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="fix.css" />

  <!-- Smooth scrolling ticker animation (keeps ribbon moving) -->
  <style>
    .ticker-viewport { overflow: hidden; }
    .ticker-track {
      white-space: nowrap;
      display: inline-block;
      will-change: transform;
      animation: tickerScroll 35s linear infinite;
    }
    .tick { display: inline-block; margin-right: 2rem; }
    @keyframes tickerScroll {
      0%   { transform: translateX(0); }
      100% { transform: translateX(-50%); }
    }
  </style>

  <!-- Google AdSense -->
  <meta name="google-adsense-account" content="ca-pub-6957786074161829" />
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6957786074161829" crossorigin="anonymous"></script>
</head>
<body>
  <!-- Header -->
  <header class="site-header">
    <div class="wrap header-row">
      <div class="brand">
        <img class="logo" src="logo.png" alt="Stock Price Predictions Logo" />
        <div>
          <h1>Shree Yantra <span>Stock Predictor</span></h1>
          <p class="tag">Vedic-inspired signals • Real OHLC • Free</p>
        </div>
      </div>
      <nav class="nav">
        <a href="index.html" aria-current="page">Home</a>
        <a href="about.html" target="_blank" rel="noopener">About</a>
        <a href="privacy.html" target="_blank" rel="noopener">Privacy</a>
        <a href="terms.html" target="_blank" rel="noopener">Terms</a>
        <a href="contact.html" target="_blank" rel="noopener">Contact</a>
      </nav>
    </div>
  </header>

  <!-- Main -->
  <main class="wrap">
    <section class="panel">
      <h2 class="hero-title">Find a stock. See today’s OHLC and a mystical hint for tomorrow.</h2>
      <p class="lede">Type a company or ticker to get live OHLC data and our Shree Yantra based next-day signal.</p>

      <div class="search-stack">
        <div class="row">
          <input id="ticker" placeholder="Type company or ticker (e.g., Tata Motors, RELIANCE.NS, AAPL)" autocomplete="off" />
          <button id="go" class="btn">Analyze</button>
        </div>
        <div id="suggestBox" class="suggest hidden" role="listbox" aria-label="Suggestions"></div>
      </div>

      <article id="card" class="card hidden" aria-live="polite">
        <header class="card-head">
          <h3 id="cTicker">-</h3>
          <span id="mktYes" class="chip" title="Market open now?">-</span>
          <div id="cSignal" class="chip">Awaiting...</div>
        </header>

        <div class="ohlc">
          <div class="kv"><span>Open</span><strong id="cOpen">-</strong></div>
          <div class="kv"><span>High</span><strong id="cHigh">-</strong></div>
          <div class="kv"><span>Low</span><strong id="cLow">-</strong></div>
          <div class="kv"><span>Close</span><strong id="cClose">-</strong></div>
        </div>

        <!-- Exact required text format -->
        <p class="pred-note" id="predNote">Prediction For Next Day Date: - : ▲ Price Up (1)</p>

        <!-- Market status line -->
        <p class="muted tiny" id="mktDisplay" aria-live="polite">Display Market: -</p>
      </article>
    </section>
  </main>

  <!-- Global indices scrolling ribbon -->
  <div class="ticker" aria-label="Global market ticker">
    <div class="wrap ticker-viewport">
      <div class="ticker-track" id="tickerTrack"></div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="footer">
    <div class="wrap footer-content">
      <p>© 2025 StockPricePredictions.com • Signals are informational only • <a href="privacy.html" target="_blank" rel="noopener">Privacy</a></p>
      <div class="social-icons">
        <a href="#" target="_blank" rel="noopener" aria-label="Facebook"><img src="icons/facebook.svg" alt="Facebook"></a>
        <a href="#" target="_blank" rel="noopener" aria-label="Twitter"><img src="icons/twitter.svg" alt="Twitter"></a>
        <a href="#" target="_blank" rel="noopener" aria-label="Instagram"><img src="icons/instagram.svg" alt="Instagram"></a>
        <a href="#" target="_blank" rel="noopener" aria-label="LinkedIn"><img src="icons/linkedin.svg" alt="LinkedIn"></a>
        <a href="#" target="_blank" rel="noopener" aria-label="YouTube"><img src="icons/youtube.svg" alt="YouTube"></a>
      </div>
    </div>
  </footer>

  <!-- ONE backend for ALL endpoints (suggest, stock, predict-next) -->
  <script>
    // CHANGE THIS to your Render URL:
    window.API_BASE = "https://stockpricepredictions-api.onrender.com";
  </script>

  <!-- App (autocomplete + OHLC + prediction + ribbon) -->
  <script>
  (function(){
    const API = (window.API_BASE || "").replace(/\/$/, "");

    const elInput     = document.getElementById("ticker");
    const elBtn       = document.getElementById("go");
    const elSuggest   = document.getElementById("suggestBox");

    const elCard      = document.getElementById("card");
    const elCTicker   = document.getElementById("cTicker");
    const elCOpen     = document.getElementById("cOpen");
    const elCHigh     = document.getElementById("cHigh");
    const elCLow      = document.getElementById("cLow");
    const elCClose    = document.getElementById("cClose");
    const elCSignal   = document.getElementById("cSignal");
    const elPredNote  = document.getElementById("predNote");
    const elDisplay   = document.getElementById("mktDisplay");
    const elYes       = document.getElementById("mktYes");
    const elTickerTrack = document.getElementById("tickerTrack");

    const fmt2 = (n) => (n == null || Number.isNaN(+n)) ? "-" :
      Number(n).toLocaleString(undefined, { maximumFractionDigits: 2 });
    const debounce = (fn, ms=160) => { let t=null; return (...a)=>{clearTimeout(t); t=setTimeout(()=>fn(...a), ms);} };
    const normalizeSymbol = (v) => {
      v = String(v||"").trim().toUpperCase();
      if (!v) return v;
      if (v.startsWith("^")) return v;     // index (not used for predict)
      if (/\.\w+$/.test(v)) return v;      // already has suffix
      return v + ".NS";                    // default NSE
    };
    const showCard = () => elCard && elCard.classList.remove("hidden");

    async function fetchJSON(url){
      const res = await fetch(url, { mode: "cors" });
      const txt = await res.text();
      let j; try { j = JSON.parse(txt); } catch { j = { error: txt }; }
      return { ok: res.ok, status: res.status, json: j };
    }

    // ------- Autocomplete via backend (robust, no Yahoo from browser) -------
    async function getSuggest(q){
      const r = await fetchJSON(`${API}/suggest?q=${encodeURIComponent(q)}`);
      if (r.ok && Array.isArray(r.json.suggestions)) return r.json.suggestions;
      return [];
    }

    function renderSuggest(items){
      if (!elSuggest) return;
      if (!items.length){
        elSuggest.innerHTML = "";
        elSuggest.classList.add("hidden");
        return;
      }
      const html = items.slice(0, 12).map(it=>{
        const sym = it.symbol || "";
        const name = it.name || "";
        const exch = it.exch || "";
        return `<div class="suggest-item" data-sym="${sym}"><strong>${sym}</strong> <span>${name}${exch?` • ${exch}`:""}</span></div>`;
      }).join("");
      elSuggest.innerHTML = html;
      elSuggest.classList.remove("hidden");
    }

    const onType = debounce(async ()=>{
      const q = elInput.value.trim();
      if (!q){ renderSuggest([]); return; }
      const list = await getSuggest(q);
      renderSuggest(list);
    });

    if (elInput){
      elInput.addEventListener("input", onType);
      elInput.addEventListener("focus", ()=> { if (elSuggest && elSuggest.innerHTML) elSuggest.classList.remove("hidden"); });
      document.addEventListener("click", (e)=>{
        if (!elSuggest) return;
        if (!elSuggest.contains(e.target) && e.target !== elInput){
          elSuggest.classList.add("hidden");
        }
      });
      if (elSuggest){
        elSuggest.addEventListener("click", (e)=>{
          const item = e.target.closest(".suggest-item");
          if (!item) return;
          const sym = item.getAttribute("data-sym");
          if (sym){
            elInput.value = sym;
            elSuggest.classList.add("hidden");
            run(sym);
          }
        });
      }
    }

    // ------- Prediction (previous completed day) + market status -------
    async function getPredict(sym){
      const r = await fetchJSON(`${API}/predict-next?symbol=${encodeURIComponent(sym)}`);
      if (!r.ok) throw new Error(r.json && r.json.error ? r.json.error : "predict-next failed");
      return r.json;
    }

    function computeSignal(prevClose, predictedClose){
      if (!isFinite(+prevClose) || !isFinite(+predictedClose)) return { chip:"→ Neutral (0)", plain:"→ Neutral (0)" };
      const diff = +predictedClose - +prevClose;
      if (Math.abs(diff) < 1e-6) return { chip:"→ Sideways (0)", plain:"→ Sideways (0)" };
      if (diff > 0) return { chip:"▲ Price Up (1)", plain:"▲ Price Up (1)" };
      return { chip:"▼ Price Down (1)", plain:"▼ Price Down (1)" };
    }

    async function run(symRaw){
      try{
        const SYM = normalizeSymbol(symRaw || elInput.value);
        if (!SYM){ return; }

        if (elCTicker) elCTicker.textContent = SYM;
        showCard();

        const data = await getPredict(SYM);

        const prev = data.previous_day || {};
        if (elCOpen)  elCOpen.textContent  = fmt2(prev.open);
        if (elCHigh)  elCHigh.textContent  = fmt2(prev.high);
        if (elCLow)   elCLow.textContent   = fmt2(prev.low);
        if (elCClose) elCClose.textContent = fmt2(prev.close);

        const predicted = data.prediction && data.prediction.predicted_close;
        const sig = computeSignal(prev.close, predicted);
        if (elCSignal) elCSignal.textContent = sig.chip;

        if (elPredNote){
          elPredNote.textContent = `Prediction For Next Day Date: ${(data.prediction && data.prediction.target_date) || "-"} : ${sig.plain}`;
        }

        const openNow = !!(data.market_meta && data.market_meta.market_open_now);
        const venue   = (data.market_meta && data.market_meta.venue) || "";
        if (elYes){
          elYes.textContent = openNow ? "Yes" : "No";
          elYes.classList.remove("chip--ok","chip--off");
          elYes.classList.add(openNow ? "chip--ok" : "chip--off");
        }
        if (elDisplay){
          elDisplay.textContent = `Display Market: ${openNow ? "Open" : "Closed"}${venue?` (${venue})`:""}`;
        }
      }catch(e){
        console.warn("run error:", e);
      }
    }

    if (elBtn){ elBtn.addEventListener("click", ()=> run()); }
    if (elInput){ elInput.addEventListener("keydown", (e)=> { if (e.key === "Enter") run(); }); }

    // ------- World indices scrolling ribbon (via backend) -------
    const INDICES = ["^GSPC","^DJI","^NDX","^FTSE","^GDAXI","^FCHI","^N225","^HSI","^AXJO","^BSESN","^NSEI","^NSEBANK"];

    async function getQuote(sym){
      const r = await fetchJSON(`${API}/stock?q=${encodeURIComponent(sym)}`);
      if (r.ok) return { price: r.json.price, change_pct: r.json.change_pct };
      return { price: null, change_pct: null };
    }

    async function loadIndices(){
      if (!elTickerTrack) return;
      const results = await Promise.all(INDICES.map(async(sym)=>{
        const q = await getQuote(sym);
        return { symbol: sym, price: q.price, change_pct: q.change_pct };
      }));
      const row = results.map(it=>{
        const p = (it.price==null) ? "0.00" : fmt2(it.price);
        const ch = (it.change_pct==null) ? "0.00%" : `${fmt2(it.change_pct)}%`;
        const cls = (it.change_pct==null) ? "" : (it.change_pct>0 ? "pos" : (it.change_pct<0 ? "neg" : ""));
        return `<span class="tick ${cls}"><strong>${it.symbol}</strong> ${p} <em>${ch}</em></span>`;
      }).join("");

      // Duplicate for seamless CSS animation
      elTickerTrack.innerHTML = row + row;

      // Restart animation each refresh (keeps it moving)
      elTickerTrack.style.animation = "none";
      // force reflow
      // eslint-disable-next-line no-unused-expressions
      elTickerTrack.offsetHeight;
      elTickerTrack.style.animation = "";
    }

    loadIndices();
    setInterval(loadIndices, 60 * 1000);
  })();
  </script>
</body>
</html>
